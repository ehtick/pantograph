<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
    />
    <title>Pantograph Example</title>

    <style>
      .app {
        width: 100%;
        display: flex;
      }
      svg {
        width: 100%;
        display: flex;
        max-height: 90vh;
      }
    </style>
  </head>

  <body>
    <div id="app"></div>
    <script type="module">
      import {
        draw,
        cut,
        fuse,
        fuseAll,
        exportSVG,
        offset,
        polarToCartesian,
      } from "./src/main.ts";
      import { drawRect } from "./src/drawShape";

      const updatePage = (drawing) => {
        const svg = exportSVG(drawing, 1);
        const canvas = document.getElementById("app");

        canvas.innerHTML = svg;
      };

      const drawPolygon = (radius, sides, { bulge = 0, fillet = 0 } = {}) => {
        const angle = 360 / sides;
        const pen = draw([radius, 0]);
        for (let i = 1; i <= sides; i++) {
          pen.bulgeArcTo(polarToCartesian(radius, angle * i), bulge);
          if (fillet) pen.customCorner(fillet);
        }
        return pen.close().rotate(90);
      };

      const drawStrokedPolygon = (
        radius,
        sides,
        { strokeWidth, bulge, fillet = 0 } = {}
      ) => {
        const outerPolygon = drawPolygon(radius + strokeWidth / 2, sides, {
          fillet,
          bulge,
        });
        const innerPolygon = offset(outerPolygon, -strokeWidth);
        return cut(outerPolygon, innerPolygon);
      };

      const polarCopy = (drawing, radius, count) => {
        const angle = 360 / count;

        const copies = [];
        for (let i = 0; i < count; i++) {
          copies.push(drawing.translateY(radius).rotate(angle * i));
        }
        return copies;
      };

      const shape = drawStrokedPolygon(50, 6, {
        strokeWidth: 3,
        fillet: 10,
        bulge: -0.2,
      }).rotate(45);
      const copies = polarCopy(shape, 80, 17);

      updatePage(fuseAll(copies.slice()));
    </script>
  </body>
</html>
